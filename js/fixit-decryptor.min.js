(()=>{var c=class{constructor(t={}){this.options=t||{},this.options.duration=this.options.duration||1440*60,this.decryptedEventSet=new Set,this.partialDecryptedEventSet=new Set,this.resetEventSet=new Set,customElements.get("fixit-encryptor")||customElements.define("fixit-encryptor",class extends HTMLElement{}),customElements.get("cipher-text")||customElements.define("cipher-text",class extends HTMLElement{})}#t(t,r,n){try{r.innerHTML=CryptoJS.enc.Base64.parse(t.innerText.replace(n,"")).toString(CryptoJS.enc.Utf8),t.parentElement.classList.add("decrypted")}catch(e){return console.error(e)}let i=r.id==="content"?this.decryptedEventSet:this.partialDecryptedEventSet;for(let e of i)e(r)}async#e(t,r){let n=t.querySelector("cipher-text"),i=n.dataset.password,e=t.querySelector(".fixit-decryptor-input"),o=e.value.trim(),{h64ToString:a}=await xxhash(),s=a(o),d=CryptoJS.SHA256(o).toString(),p=o.length%2?o.length:o.length+1;if(e.value="",e.blur(),!o)return alert("Please enter the correct password!"),console.warn("Please enter the correct password!");if(s!==i)return alert(`Password error: ${o} not the correct password!`),console.warn(`Password error: ${o} not the correct password!`);r(n,s,d.slice(p))}init({all:t,shortcode:r}){this.addEventListener("decrypted",this.options?.decrypted),this.addEventListener("partial-decrypted",this.options?.partialDecrypted),this.addEventListener("reset",this.options?.reset);let n=document.querySelector("#content");r&&(this.addEventListener("decrypted",()=>{this.initShortcodes(n)}),this.addEventListener("partial-decrypted",i=>{this.initShortcodes(i)})),t?this.initPage():r&&this.initShortcodes(n)}initPage(){this.validateCache();let t=document.querySelector("article > fixit-encryptor"),r=document.querySelector("#content"),n=()=>{this.#e(t,(i,e,o)=>{window.localStorage?.setItem(`fixit-decryptor/#${location.pathname}`,JSON.stringify({expiration:Math.ceil(Date.now()/1e3)+this.options.duration,password:e,salt:o})),this.#t(i,r,o)})};t.querySelector(".fixit-decryptor-input")?.addEventListener("keydown",i=>{i.key==="Enter"&&(i.preventDefault(),n())}),t.querySelector(".fixit-decryptor-btn")?.addEventListener("click",i=>{i.preventDefault(),n()}),t.querySelector(".fixit-encryptor-btn")?.addEventListener("click",i=>{i.preventDefault(),t.classList.remove("decrypted"),r.innerHTML="",window.localStorage?.removeItem(`fixit-decryptor/#${location.pathname}`);for(let e of this.resetEventSet)e()}),t.classList.add("initialized")}initShortcodes(t){t.querySelectorAll("fixit-encryptor:not(.initialized)").forEach(n=>{let i=()=>{let e=n.querySelector(".decryptor-content");this.#e(n,(o,a,s)=>{this.#t(o,e,s)})};n.querySelector(".fixit-decryptor-input")?.addEventListener("keydown",function(e){e.key==="Enter"&&(e.preventDefault(),i())}),n.querySelector(".fixit-decryptor-btn")?.addEventListener("click",function(e){e.preventDefault(),i()}),n.classList.add("initialized")})}validateCache(){let t=document.querySelector("#content"),n=document.querySelector("article > fixit-encryptor").querySelector("cipher-text"),i=n.dataset.password,e=JSON.parse(window.localStorage?.getItem(`fixit-decryptor/#${location.pathname}`));return!e||e?.password!==i||Number(e?.expiration)<Math.ceil(Date.now()/1e3)?(e&&(window.localStorage?.removeItem(`fixit-decryptor/#${location.pathname}`),console.warn("The password has expired, please re-enter!")),this):(this.#t(n,t,e.salt),this)}addEventListener(t,r){if(typeof r!="function")return this;switch(t){case"decrypted":this.decryptedEventSet.add(r);break;case"partial-decrypted":this.partialDecryptedEventSet.add(r);break;case"reset":this.resetEventSet.add(r);break;default:console.warn(`Event ${t} not found in FixIt Decryptor!`);break}return this}removeEventListener(t,r){if(typeof r!="function")return this;switch(t){case"decrypted":this.decryptedEventSet.delete(r);break;case"partial-decrypted":this.partialDecryptedEventSet.delete(r);break;case"reset":this.resetEventSet.delete(r);break;default:console.warn(`Event ${t} not found in FixIt Decryptor!`);break}return this}};window.FixItDecryptor=c;})();
